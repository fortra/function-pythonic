request:
  observed:
    resources:
      VPC:
        resource:
          metadata:
            name: pytest-0123456
          status:
            atProvider:
              vpcId: vpc-0123456789
      SubnetA:
        resource:
          metadata:
            name: pytest-1234567
  input:
    step: pytest
    composite: |
      class UsagesComposite(BaseComposite):
        def compose(self):
          self.usages = True
          vpc = self.resources.VPC('ec2.aws.crossplane.io/v1beta1', 'VPC')
          vpc.spec.forProvider.region = 'us-east-1'
          vpc.spec.forProvider.cidrBlock = '10.0.0.0/16'
          subnet = self.resources.SubnetA('ec2.aws.crossplane.io/v1beta1', 'Subnet')
          subnet.spec.forProvider.region = 'us-east-1'
          subnet.spec.forProvider.vpcId = vpc.status.atProvider.vpcId
          subnet.spec.forProvider.availabilityZone = 'us-east-1a'
          subnet.spec.forProvider.cidrBlock = '10.0.0.0/20'

response:
  desired:
    resources:
      VPC:
        resource:
          apiVersion: ec2.aws.crossplane.io/v1beta1
          kind: VPC
          spec:
            forProvider:
              region: us-east-1
              cidrBlock: 10.0.0.0/16
      SubnetA:
        resource:
          apiVersion: ec2.aws.crossplane.io/v1beta1
          kind: Subnet
          spec:
            forProvider:
              region: us-east-1
              vpcId: vpc-0123456789
              availabilityZone: us-east-1a
              cidrBlock: 10.0.0.0/20
      SubnetA_VPC_pytest-0123456:
        resource:
          apiVersion: apiextensions.crossplane.io/v1beta1
          kind: Usage
          spec:
            reason: spec.forProvider.vpcId = status.atProvider.vpcId
            replayDeletion: true
            by:
              apiVersion: ec2.aws.crossplane.io/v1beta1
              kind: Subnet
              resourceRef:
                name: pytest-1234567
            of:
              apiVersion: ec2.aws.crossplane.io/v1beta1
              kind: VPC
              resourceRef:
                name: pytest-0123456
